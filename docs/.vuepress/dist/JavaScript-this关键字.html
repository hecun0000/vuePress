<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript-this关键字 | 个人主页</title>
    <meta name="description" content="进击的程序源">
    <link rel="icon" href="/img/logo.ico">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/img/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.a951fa46.css" as="style"><link rel="preload" href="/assets/js/app.5ac09712.js" as="script"><link rel="preload" href="/assets/js/15.4366cb1a.js" as="script"><link rel="prefetch" href="/assets/js/14.b54f952c.js"><link rel="prefetch" href="/assets/js/2.285762ea.js"><link rel="prefetch" href="/assets/js/3.8383dafe.js"><link rel="prefetch" href="/assets/js/4.88423077.js"><link rel="prefetch" href="/assets/js/5.7bf4d87f.js"><link rel="prefetch" href="/assets/js/6.058373b9.js"><link rel="prefetch" href="/assets/js/7.3884a514.js"><link rel="prefetch" href="/assets/js/8.f7f29a62.js"><link rel="prefetch" href="/assets/js/9.81258964.js"><link rel="prefetch" href="/assets/js/10.fc13595d.js"><link rel="prefetch" href="/assets/js/11.5be0b20c.js"><link rel="prefetch" href="/assets/js/12.8b15763e.js"><link rel="prefetch" href="/assets/js/13.eccf94d9.js"><link rel="prefetch" href="/assets/js/16.f0020e84.js"><link rel="prefetch" href="/assets/js/17.f036e3a9.js"><link rel="prefetch" href="/assets/js/18.b373f4f1.js"><link rel="prefetch" href="/assets/js/19.69e9d52a.js"><link rel="prefetch" href="/assets/js/20.fa87e6ab.js"><link rel="prefetch" href="/assets/js/21.5e77bd5d.js"><link rel="prefetch" href="/assets/js/22.94d76691.js"><link rel="prefetch" href="/assets/js/23.cb42ffea.js"><link rel="prefetch" href="/assets/js/24.34a62490.js"><link rel="prefetch" href="/assets/js/25.8ae0f53a.js"><link rel="prefetch" href="/assets/js/26.6e2433e2.js"><link rel="prefetch" href="/assets/js/27.fca4b9d8.js"><link rel="prefetch" href="/assets/js/28.ea5bd219.js"><link rel="prefetch" href="/assets/js/29.77e9e865.js"><link rel="prefetch" href="/assets/js/30.5ee8ae91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a951fa46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/android/" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/ios/" class="nav-link">ios</a></li><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Web</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://www.github.com/codeteenager" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/android/" class="nav-link">Android</a></li><li class="dropdown-item"><!----> <a href="/ios/" class="nav-link">ios</a></li><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Web</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="https://www.github.com/codeteenager" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><img src="http://oxi9lrcsm.bkt.clouddn.com/56697596_p0.jpg" alt style="width: 100%"> <p>this到底是一种什么机制?<br>
this是在运行时进行绑定的,并不是在编写的时候进行绑定的,它的上下文取决于函数调用时的各种条件.this的绑定和函数声明的位置没有任何关系,只取决于<strong>函数调用时的方式</strong>也被称为调用位置.<br>
当函数在调用时, 会创建一个活动记录(AO, 也被称作为上下文). 这个记录会包含函数在哪里被调用(调用栈), 函数的调用方式, 传入的参数等信息. this就是记录这一属性的, 会在函数执行的过程中用到.</p> <h1 id="一-调用位置"><a href="#一-调用位置" aria-hidden="true" class="header-anchor">#</a> 一. 调用位置</h1> <p>调用位置就是函数在代码中被调用的位置(而不是声明的位置).
来个小例子, 分析下调用栈和调用位置:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//当前的调用栈是: baz</span>
    <span class="token comment">//因此, 当前调用位置是全局作用域  </span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;baz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// bar的调用位置 </span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//当前的调用栈是: baz -&gt; bar </span>
    <span class="token comment">//因此, 当前的调用位置在baz中</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo的调用位置</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//当前调用栈是: baz -&gt; bar -&gt; foo</span>
    <span class="token comment">//因此,当前的调用位置在foo中</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  baz的调用位置</span>
</code></pre></div><p>真正地分析出函数的调用位置, 就可以理解this的绑定了.</p> <h1 id="二-绑定规则"><a href="#二-绑定规则" aria-hidden="true" class="header-anchor">#</a> 二.绑定规则</h1> <p>首先需要找到调用位置, 然后判断需要应用下面四条规则中的那一条.</p> <h2 id="_1-默认规则"><a href="#_1-默认规则" aria-hidden="true" class="header-anchor">#</a> 1.默认规则</h2> <p>这是最常用的函数调用类型: 独立函数使用.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当调用foo()时, this.a 被解析为全局变量a. 因为函数调用时应用了this的默认绑定,因此this会指向全局.</p> <p>在代码中, foo()直接使用不带任何修饰的函数引用进行调用, 只能认为是默认绑定.</p> <h2 id="_2-隐式绑定"><a href="#_2-隐式绑定" aria-hidden="true" class="header-anchor">#</a> 2.隐式绑定</h2> <p>该规则是调用位置是否具有上下文对象, 或者说是否被某个对象拥有或者包含.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    a <span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">;</span>
    foo <span class="token punctuation">:</span> foo<span class="token punctuation">;</span>  <span class="token comment">//foo的调用位置</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    a <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
    obj2 <span class="token punctuation">:</span> obj2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span>obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//42</span>
</code></pre></div><p>首先, foo()是在全局中被声明, 然后被当做引用属性添加到obj2中. 隐式绑定规则会把函数调用中的this绑定到这个上下文对象中. 因此调用foo时的this被绑定在obj2中.</p> <blockquote><p>对象属性引用链中只有上一层或者说最后一层在调用位置中作用.</p></blockquote> <h3 id="_2-1隐式绑定的丢失"><a href="#_2-1隐式绑定的丢失" aria-hidden="true" class="header-anchor">#</a> 2.1隐式绑定的丢失</h3> <p>当隐式绑定的函数丢失绑定对象, 就会默认的转为默认绑定. 从而将this绑定到全局对象或者undefined上, 取决于是否为严格模式.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
    foo <span class="token punctuation">:</span> foo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;oops, global&quot;</span><span class="token punctuation">;</span> <span class="token comment">//a为全局对象  </span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;oops, global&quot;</span>
</code></pre></div><p>在这个例子中:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>   
</code></pre></div><p>bar只是引用了foo函数的本身, 和obj并没有任何关系. 则bar()就是对foo的直接调用. 因此为默认绑定.<br>
再来一个更有意思的例子:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doFoo</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//fn 其实引用的是foo</span>
    <span class="token function">fu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用位置</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">;</span>
    foo <span class="token punctuation">:</span> foo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;oops, global&quot;</span><span class="token punctuation">;</span> <span class="token comment">//a为全局对象 </span>
<span class="token function">doFoo</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &quot;oops, global&quot;</span>
</code></pre></div><p>首先, 在全局作用域中声明了foo的函数; 然后被添加进obj的对象中;然后doFoo函数将foo这个函数作为参数传入进去, 并在其内部进行调用.<br>
在这个例子中, 参数传递被作为一种隐式的赋值.<br>
另外, 在回调函数中, 丢失this的绑定也是比较常见的现象.</p> <h2 id="_3-显式绑定"><a href="#_3-显式绑定" aria-hidden="true" class="header-anchor">#</a> 3.显式绑定</h2> <p>当我们不想在对象的内部包含函数引用,而想在某个对象上强制调用函数?<br>
为此,JavaScript提供了call(...), apply(...)和bind(...)方法.<br>
call()/apply()/bind():</p> <ol><li>call()/apply(): 立刻调用函数, 并临时替换函数中的this为指定对象<br>
如何:
<ul><li>fun.call(obj,参数值1,参数值2,...)</li> <li>fun.apply(obj.数组)</li></ul></li> <li>bind(): 基于原函数, 创建一个新函数, 永久绑定this为指定对象<br>
如何: fun.(obj,参数值,...)
<ul><li>创建一个和fun完全一样的函数</li> <li>永久绑定fun中的this为obj</li> <li>永久绑定部分参数值</li></ul></li></ol> <p>此外, 在JavaScript语言和宿主环境中许多的新的内置函数, 其作用和bind(...)一样, 去报你的回调函数使用指定的this. 比如 [1,2,3].forEach(for, obj ); 等等...</p> <h2 id="_4-new绑定"><a href="#_4-new绑定" aria-hidden="true" class="header-anchor">#</a> 4.new绑定</h2> <p>new可以影响函数调用时this绑定行为的方法, 我们称之为new绑定.</p> <p>&quot;构造函数&quot;是类中的一些特殊方法, 使用new初始化时会调用类中的构造函数. 通常的形式是这样的:</p> <div class="language-js extra-class"><pre class="language-js"><code>something <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>构造函数:</p> <blockquote><p>在JavaScript中, 构造函数只是一些使用new操作符时被调用的函数. 它们并不会属于某个类, 也不会实例化一个类. 实际上, 它们甚至都不能说是一种特殊的函数类型, 它们只是被new操作符调用的普通函数而已.</p></blockquote> <p>在使用new来调用函数, 或者说是发生构造函数的调用时, 会自动执行下面的操作.</p> <ol><li>创建(或者说构造)一个全新的对象.</li> <li>这个新对象会被执行[[prototype]]连接.</li> <li>这个新对象会绑定到函数调用的this.</li> <li>如果没有返回其他对象, 那么new表达式中的函数会自动的返回这个新对象.</li></ol> <h1 id="三-判断this"><a href="#三-判断this" aria-hidden="true" class="header-anchor">#</a> 三.判断this</h1> <p>当判断先根据绑定的优先级来判断函数的调用位置是相应的哪条规则. 可以按照下面的顺序进行判断:</p> <ol><li>函数是否存在new中调用? 是则this绑定的是创建的对象.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>函数是否通过call, apply (显式的绑定)? 如果是的话, this绑定的是指定的对象.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bar <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>函数是否在某个上下文对象中调用(隐式绑定)? 如果是的话, this绑定在对应的上下文对象中.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bar <span class="token operator">=</span> obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>如果以上都不是的话, 使用的为默认绑定, 如果在严格模式下, 就绑定到undefined, 否则为全局对象.</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/15.4366cb1a.js" defer></script><script src="/assets/js/app.5ac09712.js" defer></script>
  </body>
</html>

---
sidebar: auto
---

# 聊聊单页应用导航   

## web应用中的导航  

### 传统导航   

在传统Web应用中，导航是一个页面为单位进行。在地址栏输入路径，页面请求会发往服务器，服务器响应并返回一个完整的HTML页面。浏览器收到HTML页面进行渲染。要显示新的内容，浏览器往往要执行一次完整的刷新动作。   

![单页面导航-单页应用导航-传统模式-2019824213950](http://img.hecun.site/单页面导航-单页应用导航-传统模式-2019824213950.png)

### 单页应用导航   

在单页应用中通常就一个index.html文件。在用户切换导航的时候视图无缝呈现。更像是原生应用。一旦页面加载完成，后续的操作都不需要刷新页面。

![单页面导航-单页面应用导航-SPA-2019824215616](http://img.hecun.site/单页面导航-单页面应用导航-SPA-2019824215616.png)  

在单页应用中，路由承载了管理应用的程序状态，业务以及数据的状态。和服务器的往返交互已经不是必须。路由通过监测路由位置的变化，就会中路由的配置项来匹配新的URL需要显示的部分，然后将其渲染。所有的路由都在浏览器端完成。  

![单页面导航-spa路由-2019824223548](http://img.hecun.site/单页面导航-spa路由-2019824223548.png)


## 路由的工作机制   

在单页应用中，客户端的路由都有以下一些特性：  

- 通过路由定义的路径来匹配URL模式  
- 当匹配成功是允许应用程序执行代码  
- 当路由触发时允许执行需要显示的视图
- 允许通过路由路径传入参数
- 允许用户使用浏览器的导航方法进行单页应用进行导航  

下面介绍下两种路由的导航方式：  

### 片段标识符  

路由可以利用 `location` 对象以编程方式访问当前路由，并且可以通过 `window` 的 `onhashchange` 对路由的变化进行监听。  

假设需要跳转待关于的页面，可以利用如下标签：

```html
<a href="#/about">关于</a>
```

对应的地址栏的URL会变成，`http://localhost:8080/#/about`。

在路由变化后，可以在监听到从从更新局部页面的渲染。    

[hashchange事件查看](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/hashchange_event)

### html5 history   

在 `history` 模式中有 `pushState` 和 `replaceState` 两个方法： 

- `pushState()`: 添加历史条目
- `replaceState()`: 替换已有历史条目   

通过两个方法可以修改浏览器历史记录栈：  

```js
history.pushState({}, null, 'about)
```

之后的路由会变化为：`http://localhost:8080/about`   

然后在 popstate 事件中对路由变化进行监听，然后更新页面视图。  

[popstate事件查看](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/popstate_event)    


## 实现一个简版的vue-router  

先看看怎么使用 `vue-router` ：  

```js
// 路由队形的组件
const Foo = { template: '<div>foo</div>' }
const Bar = { template: '<div>bar</div>' }

// 路由表
const routes = [
  { path: '/foo', component: Foo },
  { path: '/bar', component: Bar }
]
//  创建 router 实例，然后传入路由表
const router = new VueRouter({
  mode: 'hash', // 使用hash模式
  routes
})

// 创建和挂载根实例
const app = new Vue({
  router
}).$mount('#app')
```

然后，在每个组件中，可以通过 `$router` 获取到 `router` 实例， 然后他可以调用 `push` , `go` 等方法。  
在 `$route` 中，可以查看到当前路由信息，包括 `path` ， `name` 等配置。   

同时，还提供了两个全局组件 `router-view` 和 `router-link`:  

- `router-view` 渲染路由匹配到的组件
- `router-link` 实现导航   

实现的大致思路如下：  

![单页面导航-my-router-设计-2019824235118](http://img.hecun.site/单页面导航-my-router-设计-2019824235118.png)






